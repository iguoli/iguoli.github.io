---
title: Homebrew
date: 2019-12-04
modify_date: 2025-09-01
tags: macOS
key: Homebrew-2019-12-04
---

## Homebrew ä¸­çš„ Keg

### 1. ä»€ä¹ˆæ˜¯ Keg

* æ¯ä¸ª Homebrew å®‰è£…çš„è½¯ä»¶åŒ…ï¼Œéƒ½ä¼šæ”¾åœ¨ `Cellar` ç›®å½•ä¸‹ï¼Œæ¯”å¦‚ï¼š

  ```
  /opt/homebrew/Cellar/openjdk@17/17.0.11/
  ```
* è¿™ä¸ªç›®å½•å°±æ˜¯ä¸€ä¸ª **keg**ï¼Œå®ƒåŒ…å«äº†è¯¥ç‰ˆæœ¬è½¯ä»¶çš„å®Œæ•´å†…å®¹ã€‚
* ä½ å¯ä»¥æŠŠå®ƒç†è§£æˆã€ŒæŸä¸ªç‰ˆæœ¬çš„è½¯ä»¶æ¡¶ã€ã€‚

### 2. ä¸ºä»€ä¹ˆå« Kegï¼Ÿ

Homebrew çš„å‘½åçµæ„Ÿæ¥è‡ªé…¿é…’ ğŸºï¼š

* **Homebrew** = å®¶é…¿å•¤é…’
* **Cellar** = é…’çª–ï¼ˆæ‰€æœ‰é…’æ¡¶å­˜æ”¾çš„åœ°æ–¹ï¼‰
* **Keg** = å•¤é…’æ¡¶ï¼ˆä¸€ä¸ªè½¯ä»¶åŒ…å°±æ˜¯ä¸€æ¡¶ï¼‰
* **Bottle** = å•¤é…’ç“¶ï¼ˆé¢„ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶åŒ…ï¼‰
* **Tap** = å•¤é…’é¾™å¤´ï¼ˆé¢å¤–çš„è½¯ä»¶æºï¼‰

æ‰€ä»¥ï¼š

* **Cellar** â†’ æ”¾ç€ä¸€æ¡¶æ¡¶é…’ï¼ˆè½¯ä»¶ï¼‰
* **Keg** â†’ æ¯ä¸€æ¡¶é…’ï¼ˆä¸€ä¸ªè½¯ä»¶åŒ…çš„æŸä¸ªç‰ˆæœ¬ï¼‰
* **Bottle** â†’ é¢„è£…å¥½çš„é…’ç“¶ï¼ˆç›´æ¥ä¸‹è½½äºŒè¿›åˆ¶ï¼Œä¸ç”¨è‡ªå·±â€œé…¿â€æºç ï¼‰

è¿™å°±æ˜¯ Homebrew ä¸ºå•¥ç”¨ã€Œkegã€è¿™ä¸ªè¯ã€‚

### 3. Keg åœ¨å®é™…ä½¿ç”¨ä¸­çš„æ„ä¹‰

* `brew install` æ—¶ï¼ŒHomebrew ä¼šåœ¨ `Cellar` é‡Œåˆ›å»ºä¸€ä¸ª **keg**ã€‚
* Homebrew é»˜è®¤ä¼šåœ¨ `/opt/homebrew/bin/` é‡Œæ”¾ä¸€ä¸ª **symlink**ï¼ŒæŒ‡å‘ keg é‡Œçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚
  è¿™æ ·ä½ å°±èƒ½ç›´æ¥ç”¨ `java`ã€`python` ç­‰å‘½ä»¤ã€‚
* å¦‚æœæ˜¯ **keg-only**ï¼Œé‚£å°±æ˜¯ä¸è‡ªåŠ¨å»º symlinkï¼Œä½ å¾—æ‰‹åŠ¨é…ç½® PATH æˆ– JAVA\_HOMEã€‚
* **keg = Cellar é‡Œçš„æŸä¸ªå…·ä½“è½¯ä»¶ç‰ˆæœ¬ç›®å½•**

### Homebrew ä½“ç³»ç»“æ„å›¾

```mermaid
graph TD
    A[Homebrew ğŸº] --> B[Cellar é…’çª–]
    B --> C[Keg å•¤é…’æ¡¶<br/>è½¯ä»¶çš„æŸä¸ªç‰ˆæœ¬ç›®å½•]
    C -->|åŒ…å«| D[å¯æ‰§è¡Œæ–‡ä»¶/åº“ç­‰]

    A --> E[Bottle å•¤é…’ç“¶<br/>é¢„ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶åŒ…]
    A --> F[Tap å•¤é…’é¾™å¤´<br/>é¢å¤–çš„è½¯ä»¶æº]

    style A fill:#fdd835,stroke:#fbc02d,stroke-width:2px
    style B fill:#ffe082,stroke:#fbc02d
    style C fill:#fff59d,stroke:#fbc02d
    style D fill:#ffffcf,stroke:#fbc02d
    style E fill:#aed581,stroke:#689f38,stroke-width:1.5px
    style F fill:#81d4fa,stroke:#0288d1,stroke-width:1.5px
```

## å®‰è£… Homebrew

[Homebrewå›½å†…å¦‚ä½•è‡ªåŠ¨å®‰è£…ï¼ˆå›½å†…åœ°å€ï¼‰](https://zhuanlan.zhihu.com/p/111014448)

æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œè„šæœ¬ä¼šæç¤ºé€‰æ‹©å›½å†…å‡ ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„é•œåƒï¼Œé€‰æ‹©ä¸­ç§‘å¤§é•œåƒç„¶åä¸€è·¯å®‰è£…å³å¯ã€‚

```sh
/bin/zsh -c "$(curl -fsSL https://gitee.com/cunkai/HomebrewCN/raw/master/Homebrew.sh)"

# Set Homebrew-bottles mirror
export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.ustc.edu.cn/homebrew-bottles
```

<!--more-->

## æŸ¥çœ‹ Homebrew è¿œç¨‹ä»“åº“ URL

```sh
# lists all currently tapped repositories.
brew tap

# Homebrew æºä»£ç ä»“åº“
git -C "$(brew --repo)" remote -v

# Homebrew æ ¸å¿ƒè½¯ä»¶ä»“åº“
git -C "$(brew --repo homebrew/core)" remote -v

# Homebrew cask è½¯ä»¶ä»“åº“ï¼Œæä¾› macOS åº”ç”¨å’Œå¤§å‹äºŒè¿›åˆ¶æ–‡ä»¶
git -C "$(brew --repo homebrew/cask)" remote -v

# Homebrew cask å…¶ä»–ç‰ˆæœ¬ (alternative versions) è½¯ä»¶ä»“åº“ï¼Œæä¾›ä½¿ç”¨äººæ•°å¤šçš„ã€éœ€è¦çš„ç‰ˆæœ¬ä¸åœ¨ cask ä»“åº“ä¸­çš„åº”ç”¨ã€‚
git -C "$(brew --repo homebrew/cask-versions)" remote -v
```

## Homebrew ä½¿ç”¨ä»£ç†

æœ‰æ—¶å€™é•œåƒæºä¸­æ²¡æœ‰æˆ‘ä»¬è¦å®‰è£…çš„åŒ…ï¼Œè¿™æ—¶ä¼šä»å®˜æ–¹è¿æ¥è¿›è¡Œä¸‹è½½ï¼Œé€Ÿåº¦ä¾ç„¶è¾ƒæ…¢ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨ä»£ç†è¿›è¡Œä¸‹è½½ï¼Œç›´æ¥åœ¨ç»ˆç«¯è®¾ç½®ä»£ç†å³å¯ã€‚

```sh
export http_proxy=http://127.0.0.1:7890
export https_proxy=http://127.0.0.1:7890
export all_proxy=socks5://127.0.0.1:7891
```

## æ‰‹å·¥è®¾ç½® Homebrew å›½å†…é•œåƒæº

å¦‚æœéœ€è¦æ‰‹å·¥è®¾ç½®å›½å†…é•œåƒæºï¼Œå¯ä»¥é€‰æ‹©å›½å†…å¸¸ç”¨çš„æœ‰ä»¥ä¸‹ä¸‰å¤§é•œåƒæºï¼Œ

- [é˜¿é‡Œäº‘é•œåƒ](https://developer.aliyun.com/mirror/?lang=zh-CN)
- [æ¸…åå¤§å­¦é•œåƒ](https://mirrors.tuna.tsinghua.edu.cn)
- [ä¸­ç§‘å¤§é•œåƒ](https://mirrors.ustc.edu.cn)

ä¸­ç§‘å¤§é•œåƒåŒ…å« `cask` æºï¼Œå› æ­¤è¿™é‡Œä½¿ç”¨ä¸­ç§‘å¤§åšä¸ºé•œåƒæºã€‚

[é…ç½®å¸®åŠ©](https://mirrors.ustc.edu.cn/help/brew.git.html)

```sh
# æ›¿æ¢ Homebrew (Homebrew æºä»£ç ä»“åº“)
git -C "$(brew --repo)" remote set-url origin https://mirrors.ustc.edu.cn/brew.git

# æ›¿æ¢ Homebrew Core (Homebrew æ ¸å¿ƒè½¯ä»¶ä»“åº“)
git -C "$(brew --repo homebrew/core)" remote set-url origin https://mirrors.ustc.edu.cn/homebrew-core.git


# æ›¿æ¢ Homebrew Cask (Homebrew Cask è½¯ä»¶ä»“åº“ï¼Œæä¾› macOS åº”ç”¨å’Œå¤§å‹äºŒè¿›åˆ¶æ–‡ä»¶)
git -C "$(brew --repo homebrew/cask)" remote set-url origin https://mirrors.ustc.edu.cn/homebrew-cask.git

# æ›¿æ¢ Homebrew cask å…¶ä»–ç‰ˆæœ¬ (alternative versions) è½¯ä»¶ä»“åº“ï¼Œæä¾›ä½¿ç”¨äººæ•°å¤šçš„ã€éœ€è¦çš„ç‰ˆæœ¬ä¸åœ¨ cask ä»“åº“ä¸­çš„åº”ç”¨ã€‚
brew tap --custom-remote --force-auto-update homebrew/cask-versions https://mirrors.ustc.edu.cn/homebrew-cask-versions.git

# Homebrew é¢„ç¼–è¯‘äºŒè¿›åˆ¶è½¯ä»¶åŒ…
echo 'export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.ustc.edu.cn/homebrew-bottles' >> ~/.zshrc
source ~/.zshrc
```

### æ¢å¤å®˜æ–¹æº

```sh
git -C "$(brew --repo)" remote set-url origin https://github.com/Homebrew/brew.git
git -C "$(brew --repo homebrew/core)" remote set-url origin https://github.com/Homebrew/homebrew-core.git
git -C "$(brew --repo homebrew/cask)" remote set-url origin https://github.com/Homebrew/homebrew-cask.git
brew tap --custom-remote --force-auto-update homebrew/cask-versions https://github.com/Homebrew/homebrew-cask-versions
```

## Homebrew ä¸­çš„ keg-only formula

[Hard to understand what keg-only means](https://github.com/Homebrew/homebrew-core/issues/11091)

æ‰€æœ‰çš„ formula éƒ½å®‰è£…åœ¨ Cellar ä¸­ (Cellar è·¯å¾„: `brew --Cellar`)  
ä¾‹å¦‚

```sh
/usr/local/Cellar/elasticsearch/5.2.2
/usr/local/Cellar/elasticsearch@1.7/1.7.6_1
```

æ‰€æœ‰ formula éƒ½æ˜¯ opt-linked (opt è·¯å¾„)  
ä¾‹å¦‚

```sh
/usr/local/opt/elasticsearch -> ../Cellar/elasticsearch/5.2.2
/usr/local/opt/elasticsearch@1.7 -> ../Cellar/elasticsearch@1.7/1.7.6_1
```

åªæœ‰ non-keg-only çš„ formula æ‰ä¼šè½¯é“¾æ¥åˆ° Homebrew prefix (`brew --prefix`)

```sh
/usr/local/bin/elasticsearch -> ../Cellar/elasticsearch/5.2.2/bin/elasticsearch
```

é»˜è®¤æƒ…å†µä¸‹ï¼Œ`/usr/local/bin` ä¼šåœ¨ä½ çš„ `PATH` é‡Œï¼Œè€Œä¸‹é¢çš„è·¯å¾„ä¸åœ¨ `PATH` é‡Œ

```sh
(a) /usr/local/opt/elasticsearch/bin
(b) /usr/local/opt/elasticsearch@1.7/bin
```

å¯¹äºè·¯å¾„ (a)ï¼Œå› ä¸º `/usr/local/bin` å·²ç»åœ¨ `PATH` ä¸­ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰é—®é¢˜ï¼Œè¿è¡Œ `elasticsearch` ä¼šæ‰§è¡Œ `/usr/local/bin/elasticsearch`ï¼Œå…¶æŒ‡å‘ `/usr/local/Cellar/elasticsearch/5.2.2/bin/elasticsearch`ã€‚

å¯¹äºè·¯å¾„ (b)ï¼Œå› ä¸º `/usr/local/Cellar/elasticsearch@1.7/1.7.6_1/bin/elasticsearch` æ²¡æœ‰è½¯é“¾æ¥åˆ° `/usr/local/bin`ï¼Œä½ åªèƒ½é€šè¿‡å…¨è·¯å¾„æ¥æ‰§è¡Œï¼Œæˆ–è€…å°† `/usr/local/opt/elasticsearch@1.7/bin` å‰ç½®åˆ° `PATH` ä¸­ã€‚

ä¹‹æ‰€ä»¥åœ¨ `PATH` ä¸­å‰ç½® `/usr/local/opt/elasticsearch@1.7/bin` è€Œä¸æ˜¯ `/usr/local/Cellar/elasticsearch@1.7/1.7.6_1/bin` æ˜¯å› ä¸ºå¦‚æœä½ é‡åˆ°ä¿®è®¢ç‰ˆæœ¬åˆ°2 (æ¯”å¦‚ 1.7.6_2) æˆ–å‡çº§äº†å°ç‰ˆæœ¬ (1.7.7)ï¼Œ`opt` è·¯å¾„ä¾ç„¶æœ‰æ•ˆï¼Œè€Œ `Cellar` è·¯å¾„åˆ™å¿…é¡»æ›´æ–°åˆ°æ–°çš„ç‰ˆæœ¬ã€‚

`opt` è·¯å¾„å¯¹äº non-keg-only çš„ formula ä¾ç„¶æœ‰æ•ˆï¼Œä½†æ˜¯ non-keg-only formula ä¸€èˆ¬éƒ½ä¼šè½¯é“¾æ¥åˆ° `/usr/local/bin`ï¼Œä¸”è¯¥è·¯å¾„å·²ç»åœ¨ `PATH` ä¸­äº†ï¼Œæ‰€ä»¥æ²¡å¿…è¦ä½¿ç”¨ `opt` è·¯å¾„ã€‚å¦‚æœä½  `brew unlink` äº†ä¸€ä¸ª non-keg-only formulaï¼Œé‚£å®ƒå°±å˜æˆä¸€ä¸ª keg-only formulaï¼Œè¿™æ—¶é€šè¿‡å‰ç½®å®ƒçš„ `opt` è·¯å¾„åˆ° `PATH`ï¼Œå³ä½¿ä½  unlink äº†å®ƒï¼Œä½ ä¾ç„¶å¯ä»¥ç»§ç»­ä½¿ç”¨è¿™ä¸ª formulaã€‚è¿™åœ¨ä½ å®‰è£…ä¸¤ä¸ªæœ‰å†²çªçš„ non-keg-only çš„ formula æ—¶éå¸¸æœ‰ç”¨ï¼Œä½ å¯ä»¥ unlink å…¶ä¸­ä¸€ä¸ªæ¥è§£å†³å†²çªã€‚
