---
title: Ansible 笔记
date: 2022-11-18
modify_date: 2022-11-18
tags: Devops
key: Ansible-2022-11-18
---

## [Module](https://docs.ansible.com/ansible/latest/user_guide/modules.html)

> Modules are the main building blocks of Ansible playbooks. Although we do not generally speak of “module plugins”, a module is a type of plugin. For a developer-focused description of the differences between modules and other plugins, see [Modules and plugins: what is the difference?](https://docs.ansible.com/ansible/latest/dev_guide/developing_locally.html#modules-vs-plugins)

> Modules and plugins: what is the difference?
>
> If you are looking to add functionality to Ansible, you might wonder whether you need a module or a plugin. Here is a quick overview to help you understand what you need:
>
> - Modules are reusable, standalone scripts that can be used by the Ansible API, the ansible command, or the ansible-playbook command. Modules provide a defined interface. Each module accepts arguments and returns information to Ansible by printing a JSON string to stdout before exiting. Modules execute on the target system (usually that means on a remote system) in separate processes. Modules are technically plugins, but for historical reasons we do not usually talk about “module plugins”.
>
> - Plugins extend Ansible’s core functionality and execute on the control node within the /usr/bin/ansible process. Plugins offer options and extensions for the core features of Ansible - transforming data, logging output, connecting to inventory, and more.

<!--more-->

### Name convention

`<Namespace>.<Collection>.<Module>`

### Plugin documentation tool

```sh
# List all docs for available plugins (default to "module")
ansible-doc -l

# List all docs for builtin modules
ansible-doc -l ansible.builtin

# List all docs for shell plugins
ansible-doc -l -t shell

# view the doc of file module
ansible-doc ansible.builtin.file
# short format
ansible-doc file
```

## Cheat sheets

```ini
# hosts file

[controller]
localhost ansible_connection=local

[targets]
fedora-vm ansible_connection=ssh ansible_host=10.211.55.4 ansible_user=parallels
```

在远程主机执行命令

```sh
ansible <host pattern> -i hosts -m command -a hostname
ansible <host pattern> -i hosts -m shell -a hostname
ansible <host pattern> -i hosts -a hostname
```

在命令行指定主机，而不通过 inventory 文件，注意 `-i` 参数中指定的主机最后要加逗号 `,`。

```sh
# run in local
ansible all -i localhost, -c local -m setup

# run in target host
ansible all -i target_hostname, -u login_name -m setup

# run playbook, requires 'hosts: all' in your playbook
ansible-playbook -i target_hostname, site.yml
```
