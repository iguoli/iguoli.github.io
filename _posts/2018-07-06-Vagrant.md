---
title: 使用 Vagrant 快速创建虚拟机
date: 2018-07-06
modify_date: 2021-11-05
tags: Vagrant
key: Vagrant-2018-07-06
---

## 创建 Vagrantfile

生成 Vagrantfile 文件

```bash
vagrant init generic/centos8
```

或直接创建 Vagrantfile

```ruby
# -*- mode: ruby -*-
# vi: set ft=ruby :

Vagrant.configure("2") do |config|

  config.vm.box = "generic/centos8"
  config.vm.network "private_network", ip: "192.168.33.10"
  config.vm.hostname = "v-centos8-1"
  config.vm.define "centos8-1"
  config.vm.synced_folder "~/Downloads", "/home/vagrant/Downloads"

  config.vm.provider "virtualbox" do |vb|
    vb.name = "centos8-1"
  end

  # Reverse port forwarding that guest machine can access the port on the host
  config.ssh.extra_args = ["R", "7890:localhost:7890"]

end
```

<!--more-->

## Vagrant 常用命令

### 列出所有 Vagrant 虚拟机状态

```bash
vagrant global-status
```

```text
id       name      provider   state   directory
--------------------------------------------------------------------------
5beb3f1  centos8-1 virtualbox running /Vagrant/centos8-1
b70aca5  centos8-2 virtualbox running /Vagrant/centos8-2
```

### 删除虚拟机

```bash
vagrant destroy 5beb3f1
```


### SSH 到虚拟机

```bash
vagrant ssh 5beb3f1
```

## Network

### VirtualBox network

<style>
    .network-table td:nth-child(1) { font-weight: bold; background-color: whitesmoke}
    .network-table tr:nth-child(1) td:nth-child(n+2):nth-child(-n+6) { background: red; }
    .network-table tr:nth-child(2) td:nth-child(2) { background: red; }
    .network-table tr:nth-child(2) td:nth-child(3) { background: palegreen; }
    .network-table tr:nth-child(2) td:nth-child(4) { background: orange; }
    .network-table tr:nth-child(2) td:nth-child(5) { background: palegreen; }
    .network-table tr:nth-child(2) td:nth-child(6) { background: orange; }
    .network-table tr:nth-child(3) td:nth-child(n+2):nth-child(-n+3) { background: palegreen; }
    .network-table tr:nth-child(3) td:nth-child(4) { background: orange; }
    .network-table tr:nth-child(3) td:nth-child(5) { background: palegreen; }
    .network-table tr:nth-child(3) td:nth-child(6) { background: orange; }
    .network-table tr:nth-child(4) td:nth-child(n+2):nth-child(-n+6) { background: palegreen; }
    .network-table tr:nth-child(5) td:nth-child(2) { background: palegreen; }
    .network-table tr:nth-child(5) td:nth-child(n+3):nth-child(-n+6) { background: red; }
    .network-table tr:nth-child(6) td:nth-child(n+2):nth-child(-n+4) { background: palegreen; }
    .network-table tr:nth-child(6) td:nth-child(5) { background: red; }
    .network-table tr:nth-child(6) td:nth-child(6) { background: palegreen; }
</style>

|                  | VM ↔ VM | VM → Host |  VM ← Host   | VM → LAN |   VM ← LAN   |
| ---------------- | :-----: | :--------: | :----------: | :------: | :----------: |
| Not attached     |    ✕    |     ✕      |      ✕       |    ✕     |      ✕       |
| NAT              |    ✕    |     ✓      | Port Forward |    ✓     | Port Forward |
| NAT Network      |    ✓    |     ✓      | Port Forward |    ✓     | Port Forward |
| Bridged          |    ✓    |     ✓      |      ✓       |    ✓     |      ✓       |
| Internal Network |    ✓    |     ✕      |      ✕       |    ✕     |      ✕       |
| Host-only        |    ✓    |     ✓      |      ✓       |    ✕     |      ✓       |
{:.network-table}

### Vagrant network

Vagrant 与 VirtualBox 的网络对应如下

| Vagrant network | VirtualBox network |
| :-------------: | :----------------: |
| forwarded_port  |        NAT         |
| private_network |     Host-only      |
| public_network  |      Bridged       |

##### 注意: NAT 网络将被隐含地创建

如果配置文件只有一个 `private_network`，Vagrant 会创建 一个 NAT 网络和一个 Host-only 网络

```ruby
# NAT and Host-only network
config.vm.network "private_network", ip: "192.168.33.10"
```

如果配置文件有两个以上的 `private_network`，Vagrant 不再自动创建 NAT 网络，只有多个 Host-only 网络

```ruby
# Two Host-only networks
config.vm.network "private_network", ip: "192.168.9.10"
config.vm.network "private_network", ip: "192.168.33.10"
```

## 参考文档

- [VirtualBox Network Settings: Complete Guide](https://www.nakivo.com/blog/virtualbox-network-setting-guide/)
- [Vagrant 网络配置](https://juejin.cn/post/6844903783705608205)
- [Vagrant provider networking](https://www.vagrantup.com/docs/providers/virtualbox/networking)